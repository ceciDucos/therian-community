import{a as ee}from"./chunk-BPALIKTN.js";import{a as Z}from"./chunk-HWHG6NHR.js";import{a as U}from"./chunk-KCUVPFKU.js";import{a as A}from"./chunk-GS3VH2CW.js";import"./chunk-A7VTSCNG.js";import{a as G}from"./chunk-UOP3CD4R.js";import{b as $,d as H,e as R,g as L,h as W,i as Y,j as q,k as J,l as K,m as Q,o as X}from"./chunk-ZFKS3NJ4.js";import{b as z,c as D,e as j}from"./chunk-6I7YCHVY.js";import{C as x,D as P,E as M,Ea as m,F as h,Fa as f,G as k,Ga as b,K as C,Oa as N,Qa as a,R as O,Ra as l,S as n,W as E,Za as B,_a as V,a as y,ab as I,ba as g,ca as u,fa as T,ga as F,ha as _,ia as o,ja as r,ka as c,oa as w,qa as S,sa as v}from"./chunk-RTC3656N.js";var ie=(t,i)=>({"profile__avatar-selection-button--selected":t,"profile__avatar-selection-button--unselected":i}),ne=(t,i)=>i.url;function oe(t,i){t&1&&(o(0,"div",2),m(1),a(2,"translate"),r()),t&2&&(n(),b(" ",l(2,1,"profile.loading")," "))}function re(t,i){if(t&1&&c(0,"img",8),t&2){let e,p=v(2);_("src",(e=p.profileForm.get("avatar_url"))==null?null:e.value,O)}}function ae(t,i){if(t&1&&(o(0,"span"),m(1),a(2,"uppercase"),r()),t&2){let e,p=v(2);n(),f(l(2,1,((e=p.profile())==null||e.username==null?null:e.username.charAt(0))||"?"))}}function le(t,i){t&1&&(o(0,"div",35)(1,"div"),h(),o(2,"svg",36),c(3,"polyline",37),r()()())}function pe(t,i){if(t&1){let e=w();o(0,"button",33),S("click",function(){let s=P(e).$implicit,d=v(2);return M(d.selectAvatar(s.url))}),c(1,"img",34),g(2,le,4,0,"div",35),r()}if(t&2){let e,p,s=i.$implicit,d=v(2);_("ngClass",N(4,ie,((e=d.profileForm.get("avatar_url"))==null?null:e.value)===s.url,((e=d.profileForm.get("avatar_url"))==null?null:e.value)!==s.url)),n(),_("src",s.url,O)("alt",s.name),n(),u(((p=d.profileForm.get("avatar_url"))==null?null:p.value)===s.url?2:-1)}}function se(t,i){t&1&&(h(),o(0,"svg",27),c(1,"path",38)(2,"polyline",39),r())}function de(t,i){t&1&&(h(),o(0,"svg",27),c(1,"circle",40)(2,"line",41)(3,"line",42),r())}function ce(t,i){if(t&1&&(o(0,"div",29),g(1,se,3,0,":svg:svg",27),g(2,de,4,0,":svg:svg",27),m(3),r()),t&2){let e=v(2);_("ngClass",e.messageType()==="success"?"profile__message--success":"profile__message--error"),n(),u(e.messageType()==="success"?1:-1),n(),u(e.messageType()==="error"?2:-1),n(),b(" ",e.message()," ")}}function me(t,i){t&1&&(o(0,"span",32),h(),o(1,"svg",43),c(2,"circle",44)(3,"path",45),r(),m(4),a(5,"translate"),r()),t&2&&(n(4),b(" ",l(5,1,"profile.saving")," "))}function _e(t,i){t&1&&(o(0,"span"),m(1),a(2,"translate"),r()),t&2&&(n(),f(l(2,1,"profile.saveChanges")))}function fe(t,i){if(t&1){let e=w();o(0,"form",4),S("ngSubmit",function(){P(e);let s=v();return M(s.onSubmit())}),o(1,"div",5)(2,"div",6)(3,"div",7),g(4,re,1,1,"img",8)(5,ae,3,3,"span"),r()(),o(6,"div",9)(7,"h3"),m(8),r(),o(9,"p"),m(10),r()()(),c(11,"hr",10),o(12,"div",11)(13,"label"),m(14,"Choose an Avatar"),r(),o(15,"div",12),T(16,pe,3,7,"button",13,ne),r()(),c(18,"hr",10),o(19,"div",14),c(20,"app-input",15),a(21,"translate"),a(22,"translate"),o(23,"div",16),c(24,"app-input",17),a(25,"translate"),a(26,"translate"),c(27,"app-input",18),a(28,"translate"),a(29,"translate"),r(),o(30,"div",19)(31,"label"),m(32),a(33,"translate"),r(),c(34,"textarea",20),a(35,"translate"),r(),o(36,"div",19)(37,"label"),m(38),a(39,"translate"),r(),o(40,"div",21)(41,"select",22)(42,"option",23),m(43),a(44,"translate"),r(),o(45,"option",24),m(46),a(47,"translate"),r(),o(48,"option",25),m(49),a(50,"translate"),r()(),o(51,"div",26),h(),o(52,"svg",27),c(53,"path",28),r()()()()(),g(54,ce,4,4,"div",29),k(),o(55,"div",30)(56,"app-button",31),g(57,me,6,3,"span",32)(58,_e,3,3,"span"),r()()()}if(t&2){let e,p,s,d=v();_("formGroup",d.profileForm),n(4),u((e=d.profileForm.get("avatar_url"))!=null&&e.value?4:5),n(4),f((p=d.profile())==null?null:p.username),n(2),f((s=d.authService.user())==null?null:s.email),n(6),F(d.masks),n(4),_("label",l(21,19,"profile.displayName"))("placeholder",l(22,21,"profile.displayNamePlaceholder")),n(4),_("label",l(25,23,"profile.theriotype"))("placeholder",l(26,25,"profile.theriotypePlaceholder")),n(3),_("label",l(28,27,"profile.pronouns"))("placeholder",l(29,29,"profile.pronounsPlaceholder")),n(5),f(l(33,31,"profile.bio")),n(2),_("placeholder",l(35,33,"profile.bioPlaceholder")),n(4),f(l(39,35,"profile.explorationStatus")),n(5),f(l(44,37,"profile.exploring")),n(3),f(l(47,39,"profile.defined")),n(3),f(l(50,41,"profile.preferNotSay")),n(5),u(d.message()?54:-1),n(2),_("disabled",d.saving()),n(),u(d.saving()?57:58)}}var te=class t{authService=x(A);profileService=x(ee);translate=x(z);fb=x(Q);profile=C(null);loading=C(!0);saving=C(!1);message=C("");messageType=C("success");profileForm=this.fb.group({display_name:[""],theriotype:[""],pronouns:[""],bio:[""],exploration_status:["exploring"],avatar_url:[""]});masks=[{id:"wolf",url:"assets/masks/wolf.png",name:"Wolf"},{id:"cat",url:"assets/masks/cat.png",name:"Cat"},{id:"deer",url:"assets/masks/deer.png",name:"Deer"},{id:"raven",url:"assets/masks/raven.png",name:"Raven"},{id:"dragon",url:"assets/masks/dragon.png",name:"Dragon"}];async ngOnInit(){let i=await this.authService.getCurrentUser();i?await this.loadProfile(i.id):this.loading.set(!1)}async loadProfile(i){this.loading.set(!0);let{data:e,error:p}=await this.profileService.getProfile(i);e&&(this.profile.set(e),this.profileForm.patchValue({display_name:e.display_name,theriotype:e.theriotype,pronouns:e.pronouns,bio:e.bio,exploration_status:e.exploration_status||"exploring",avatar_url:e.avatar_url})),this.loading.set(!1)}selectAvatar(i){this.profileForm.patchValue({avatar_url:i}),this.profileForm.markAsDirty()}async onSubmit(){if(this.profileForm.invalid)return;this.saving.set(!0),this.message.set("");let i=this.authService.user();if(!i)return;let e={display_name:this.profileForm.value.display_name,bio:this.profileForm.value.bio,avatar_url:this.profileForm.value.avatar_url,updated_at:new Date};if(!this.profile()){let s=i.email||"";e.username=s.split("@")[0]||`user_${i.id.slice(0,8)}`}let{error:p}=await this.profileService.updateProfile(i.id,e);p?(this.message.set(this.translate.instant("profile.updateError")),this.messageType.set("error")):(this.message.set(this.translate.instant("profile.updateSuccess")),this.messageType.set("success"),this.profile.update(s=>y(y({},s),e))),this.saving.set(!1)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["app-profile"]],decls:5,vars:6,consts:[[1,"profile"],[3,"header","title"],[1,"profile__loading"],[1,"profile__form",3,"formGroup"],[1,"profile__form",3,"ngSubmit","formGroup"],[1,"profile__header"],[1,"profile__header-avatar-wrapper"],[1,"profile__header-avatar"],[3,"src"],[1,"profile__header-info"],[1,"profile__divider"],[1,"profile__avatar-selection"],[1,"profile__avatar-selection-grid"],["type","button",1,"profile__avatar-selection-button",3,"ngClass"],[1,"profile__fields"],["formControlName","display_name",3,"label","placeholder"],[1,"profile__fields-row"],["formControlName","theriotype",3,"label","placeholder"],["formControlName","pronouns",3,"label","placeholder"],[1,"profile__field"],["formControlName","bio",3,"placeholder"],[1,"profile__select-wrapper"],["formControlName","exploration_status"],["value","exploring"],["value","defined"],["value","prefer_not_say"],[1,"profile__select-wrapper-icon"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","m6 9 6 6 6-6"],[1,"profile__message",3,"ngClass"],[1,"profile__actions"],["type","submit","variant","primary","size","lg",3,"disabled"],[1,"profile__saving"],["type","button",1,"profile__avatar-selection-button",3,"click","ngClass"],[3,"src","alt"],[1,"profile__avatar-selection-button-overlay"],["xmlns","http://www.w3.org/2000/svg","width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","4","stroke-linecap","round","stroke-linejoin","round"],["points","20 6 9 17 4 12"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14"],["points","22 4 12 14.01 9 11.01"],["cx","12","cy","12","r","10"],["x1","15","y1","9","x2","9","y2","15"],["x1","9","y1","9","x2","15","y2","15"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(e,p){e&1&&(o(0,"div",0)(1,"app-card",1),a(2,"translate"),g(3,oe,3,3,"div",2),g(4,fe,59,43,"form",3),r()()),e&2&&(n(),_("header",!0)("title",l(2,4,"profile.title")),n(2),u(p.loading()?3:-1),n(),u(p.loading()?-1:4))},dependencies:[I,B,X,L,J,K,$,q,H,R,Y,W,G,Z,U,j,V,D],styles:[".profile[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:3rem 1rem}@media(min-width:768px){.profile[_ngcontent-%COMP%]{padding-left:1.5rem;padding-right:1.5rem}}@media(min-width:1024px){.profile[_ngcontent-%COMP%]{padding:5rem 2rem}}.profile[_ngcontent-%COMP%]{max-width:48rem;margin:0 auto;width:100%}.profile__loading[_ngcontent-%COMP%]{padding:3rem 0;text-align:center;color:hsl(var(--muted-foreground));animation:_ngcontent-%COMP%_pulse 2s cubic-bezier(.4,0,.6,1) infinite}.profile__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem}.profile__header[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;position:relative;text-align:center}.profile__header-avatar-wrapper[_ngcontent-%COMP%]{position:relative}.profile__header-avatar[_ngcontent-%COMP%]{width:8rem;height:8rem;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:2.25rem;font-weight:700;color:hsl(var(--secondary-foreground));overflow:hidden;border:4px solid hsl(var(--primary)/.2);box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;background-color:#fff}.profile__header-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;mix-blend-mode:multiply}.profile__header-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.profile__header-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:hsl(var(--foreground));margin:0}.profile__header-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.875rem;color:hsl(var(--muted-foreground));margin:0}.profile__divider[_ngcontent-%COMP%]{border:none;border-top:1px solid hsl(var(--border)/.5);margin:0}.profile__avatar-selection[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.profile__avatar-selection[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:hsl(var(--foreground)/.8);display:block}.profile__avatar-selection-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1rem}@media(min-width:768px){.profile__avatar-selection-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(5,minmax(0,1fr))}}.profile__avatar-selection-button[_ngcontent-%COMP%]{position:relative;aspect-ratio:1/1;border-radius:1rem;overflow:hidden;border:2px solid transparent;transition:all .2s;cursor:pointer;padding:0;background-color:#fff}.profile__avatar-selection-button[_ngcontent-%COMP%]:hover{transform:scale(1.1);box-shadow:0 10px 15px -3px #0000001a,0 4px 6px -4px #0000001a;z-index:10}.profile__avatar-selection-button[_ngcontent-%COMP%]:focus-visible{outline:none;box-shadow:0 0 0 2px hsl(var(--ring)),0 0 0 4px hsl(var(--background))}.profile__avatar-selection-button--selected[_ngcontent-%COMP%]{border-color:hsl(var(--primary));opacity:1}.profile__avatar-selection-button--unselected[_ngcontent-%COMP%]{border-color:transparent;opacity:.6}[data-theme=dark][_ngcontent-%COMP%]   .profile__avatar-selection-button--unselected[_ngcontent-%COMP%]{opacity:.8;background-color:#e5e7eb}.profile__avatar-selection-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:contain;mix-blend-mode:multiply}.profile__avatar-selection-button-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:hsl(var(--primary)/.1);display:flex;align-items:center;justify-content:center}.profile__avatar-selection-button-overlay[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{background-color:hsl(var(--primary));color:hsl(var(--primary-foreground));border-radius:50%;padding:.375rem;box-shadow:0 1px 2px #0000000d;display:flex;align-items:center;justify-content:center;transform:scale(1.2)}.profile__fields[_ngcontent-%COMP%], .profile__fields-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}@media(min-width:768px){.profile__fields-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr))}}.profile__field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.profile__field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:500;line-height:1;color:hsl(var(--foreground))}.profile__field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{display:flex;min-height:120px;width:100%;border-radius:.375rem;border:1px solid hsl(var(--input));background-color:hsl(var(--background));padding:.75rem 1rem;font-size:.875rem;color:hsl(var(--foreground));resize:none;transition:all .2s;font-family:inherit}.profile__field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]::placeholder{color:hsl(var(--muted-foreground))}.profile__field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus-visible{outline:none;box-shadow:0 0 0 2px hsl(var(--ring)),0 0 0 4px hsl(var(--background))}.profile__field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.5}.profile__select-wrapper[_ngcontent-%COMP%]{position:relative}.profile__select-wrapper[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{display:flex;height:3rem;width:100%;border-radius:.375rem;border:1px solid hsl(var(--input));background-color:hsl(var(--background));padding:.5rem 1rem;font-size:.875rem;color:hsl(var(--foreground));appearance:none;transition:all .2s;cursor:pointer;font-family:inherit}.profile__select-wrapper[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:hover{background-color:hsl(var(--muted)/.05)}.profile__select-wrapper[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus-visible{outline:none;box-shadow:0 0 0 2px hsl(var(--ring)),0 0 0 4px hsl(var(--background))}.profile__select-wrapper[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.5}.profile__select-wrapper-icon[_ngcontent-%COMP%]{position:absolute;right:.75rem;top:50%;transform:translateY(-50%);pointer-events:none;color:hsl(var(--muted-foreground));display:flex;align-items:center}.profile__message[_ngcontent-%COMP%]{padding:1rem;font-size:.875rem;border-radius:.375rem;display:flex;align-items:center;gap:.75rem;font-weight:500}.profile__message--success[_ngcontent-%COMP%]{background-color:#10b9811a;color:#10b981;border:1px solid rgba(16,185,129,.2)}[data-theme=dark][_ngcontent-%COMP%]   .profile__message--success[_ngcontent-%COMP%]{color:#6ee7b7;background-color:#064e3b66}.profile__message--error[_ngcontent-%COMP%]{background-color:#ef44441a;color:#ef4444;border:1px solid rgba(239,68,68,.2)}[data-theme=dark][_ngcontent-%COMP%]   .profile__message--error[_ngcontent-%COMP%]{color:#fca5a5;background-color:#7f1d1d33}.profile__actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding-top:1rem}.profile__saving[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.profile__saving[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite;height:1.25rem;width:1.25rem}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.5}}"]})};export{te as ProfileComponent};
