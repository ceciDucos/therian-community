import{a as O}from"./chunk-H32VASCQ.js";import{a as j,b as $}from"./chunk-3TOK5YK3.js";import{a as F}from"./chunk-M6UWFHQV.js";import{c as N,e as V}from"./chunk-R2LU7DUE.js";import{C as g,Ca as p,D as C,Da as _,E as k,Ea as v,Fa as x,Ga as E,K as h,Oa as o,Pa as d,Qa as R,S as n,W as U,Xa as A,Ya as P,Za as M,a as T,ba as m,ca as u,fa as w,ga as S,ha as B,ia as r,ja as a,oa as I,qa as b,sa as f,y as D}from"./chunk-DB7Y4EIF.js";var y=class i{supabase=g(j);async getReports(t="pending"){let{data:e,error:s}=await this.supabase.client.from("reports").select("*").eq("status",t).order("created_at",{ascending:!1});return{data:e,error:s}}async createReport(t){let e=(await this.supabase.client.auth.getUser()).data.user;if(!e)return{error:"Not authenticated"};let{error:s}=await this.supabase.client.from("reports").insert(T({reporter_id:e.id},t));return{error:s}}async updateReportStatus(t,e,s){let l=(await this.supabase.client.auth.getUser()).data.user;if(!l)return{error:"Not authenticated"};let c={status:e,reviewed_by:l.id,reviewed_at:new Date().toISOString()};s&&(c.admin_notes=s);let{error:G}=await this.supabase.client.from("reports").update(c).eq("id",t);return{error:G}}async getBlockedUsers(){let{data:t,error:e}=await this.supabase.client.from("blocked_users").select("*, profile:blocked_user_id(username, display_name)").order("created_at",{ascending:!1});return{data:t,error:e}}async blockUser(t,e){let s=(await this.supabase.client.auth.getUser()).data.user;if(!s)return{error:"Not authenticated"};let{error:l}=await this.supabase.client.from("blocked_users").insert({blocked_user_id:t,blocked_by:s.id,reason:e});return{error:l}}async unblockUser(t){let{error:e}=await this.supabase.client.from("blocked_users").delete().eq("id",t);return{error:e}}static \u0275fac=function(e){return new(e||i)};static \u0275prov=D({token:i,factory:i.\u0275fac,providedIn:"root"})};var z=(i,t)=>t.id;function J(i,t){i&1&&(r(0,"div",5),p(1),o(2,"translate"),a()),i&2&&(n(),_(d(2,1,"admin.loadingReports")))}function K(i,t){i&1&&(r(0,"div",6),p(1),o(2,"translate"),a()),i&2&&(n(),v(" ",d(2,1,"admin.noReports")," "))}function L(i,t){if(i&1){let e=I();r(0,"app-card",7)(1,"div",8)(2,"div")(3,"span",9),p(4),o(5,"uppercase"),a(),r(6,"p",10),p(7),o(8,"translate"),a(),r(9,"p",11),p(10),o(11,"translate"),a(),r(12,"p",12),p(13),o(14,"translate"),o(15,"date"),a()(),r(16,"div",13)(17,"app-button",14),b("click",function(){let l=C(e).$implicit,c=f(2);return k(c.resolveReport(l.id,"dismissed"))}),p(18),o(19,"translate"),a(),r(20,"app-button",15),b("click",function(){let l=C(e).$implicit,c=f(2);return k(c.resolveReport(l.id,"actioned"))}),p(21),o(22,"translate"),a()()()()}if(i&2){let e=t.$implicit;n(4),v(" ",d(5,9,e.content_type)," "),n(3),x("",d(8,11,"admin.reason"),": ",e.reason),n(3),x("",d(11,13,"admin.contentId"),": ",e.content_id),n(3),x("",d(14,15,"admin.reportedOn"),": ",R(15,17,e.created_at,"medium")),n(5),_(d(19,20,"admin.dismiss")),n(3),_(d(22,22,"admin.takeAction"))}}function Q(i,t){if(i&1&&(r(0,"div",4),m(1,J,3,3,"div",5),m(2,K,3,3,"div",6),w(3,L,23,24,"app-card",7,z),a()),i&2){let e=f();n(),u(e.loading()?1:-1),n(),u(!e.loading()&&e.reports().length===0?2:-1),n(),S(e.reports())}}function W(i,t){i&1&&(r(0,"div",5),p(1),o(2,"translate"),a()),i&2&&(n(),_(d(2,1,"admin.loadingUsers")))}function X(i,t){i&1&&(r(0,"div",6),p(1),o(2,"translate"),a()),i&2&&(n(),v(" ",d(2,1,"admin.noBlocked")," "))}function Y(i,t){if(i&1){let e=I();r(0,"app-card",7)(1,"div",16)(2,"div")(3,"h3",17),p(4),o(5,"translate"),a(),r(6,"p",18),p(7),o(8,"translate"),a(),r(9,"p",19),p(10),o(11,"translate"),o(12,"date"),a()(),r(13,"app-button",14),b("click",function(){let l=C(e).$implicit,c=f(2);return k(c.unblockUser(l.id))}),p(14),o(15,"translate"),a()()()}if(i&2){let e=t.$implicit;n(4),x("",d(5,8,"admin.userId"),": ",e.blocked_user_id),n(3),x("",d(8,10,"admin.reason"),": ",e.reason),n(3),E("",d(11,12,"admin.blockedBy"),": ",e.blocked_by," ",d(12,14,e.created_at)),n(4),_(d(15,16,"admin.unblock"))}}function Z(i,t){if(i&1&&(r(0,"div",4),m(1,W,3,3,"div",5),m(2,X,3,3,"div",6),w(3,Y,16,18,"app-card",7,z),a()),i&2){let e=f();n(),u(e.loading()?1:-1),n(),u(!e.loading()&&e.blockedUsers().length===0?2:-1),n(),S(e.blockedUsers())}}var q=class i{moderationService=g(y);authService=g($);activeTab=h("reports");reports=h([]);blockedUsers=h([]);loading=h(!1);ngOnInit(){this.loadReports()}async loadReports(){this.loading.set(!0);let{data:t}=await this.moderationService.getReports("pending");t&&this.reports.set(t),this.loading.set(!1)}async loadBlockedUsers(){this.loading.set(!0);let{data:t}=await this.moderationService.getBlockedUsers();t&&this.blockedUsers.set(t),this.loading.set(!1)}async setTab(t){this.activeTab.set(t),t==="reports"?await this.loadReports():await this.loadBlockedUsers()}async resolveReport(t,e){await this.moderationService.updateReportStatus(t,e),await this.loadReports()}async unblockUser(t){await this.moderationService.unblockUser(t),await this.loadBlockedUsers()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=U({type:i,selectors:[["app-admin-dashboard"]],decls:13,vars:13,consts:[[1,"container","mx-auto","py-8","px-4"],[1,"text-3xl","font-bold","tracking-tight","mb-6"],[1,"flex","gap-4","mb-6"],[3,"click","variant"],[1,"space-y-4"],[1,"text-center","py-8"],[1,"text-center","py-8","text-muted-foreground","bg-muted","rounded-lg"],[1,"mb-4"],[1,"flex","justify-between","items-start"],[1,"inline-block","px-2","py-1","text-xs","font-semibold","rounded-full","bg-yellow-100","text-yellow-800","mb-2"],[1,"font-medium"],[1,"text-sm","text-muted-foreground"],[1,"text-xs","text-muted-foreground","mt-1"],[1,"flex","flex-col","gap-2"],["size","sm","variant","outline",3,"click"],["size","sm","variant","danger",3,"click"],[1,"flex","justify-between","items-center"],[1,"font-bold"],[1,"text-sm"],[1,"text-xs","text-muted-foreground"]],template:function(e,s){e&1&&(r(0,"div",0)(1,"h1",1),p(2),o(3,"translate"),a(),r(4,"div",2)(5,"app-button",3),b("click",function(){return s.setTab("reports")}),p(6),o(7,"translate"),a(),r(8,"app-button",3),b("click",function(){return s.setTab("users")}),p(9),o(10,"translate"),a()(),m(11,Q,5,2,"div",4),m(12,Z,5,2,"div",4),a()),e&2&&(n(2),_(d(3,7,"admin.title")),n(3),B("variant",s.activeTab()==="reports"?"primary":"outline"),n(),v(" ",d(7,9,"admin.pendingReports")," "),n(2),B("variant",s.activeTab()==="users"?"primary":"outline"),n(),v(" ",d(10,11,"admin.blockedUsers")," "),n(2),u(s.activeTab()==="reports"?11:-1),n(),u(s.activeTab()==="users"?12:-1))},dependencies:[M,F,O,V,A,P,N],encapsulation:2})};export{q as AdminDashboardComponent};
