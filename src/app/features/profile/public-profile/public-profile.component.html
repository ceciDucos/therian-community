<div class="max-w-2xl mx-auto py-8 px-4">
    <!-- Loading -->
    @if (loading()) {
    <div class="text-center py-16">
        <div class="inline-block w-8 h-8 border-4 border-primary/30 border-t-primary rounded-full animate-spin"></div>
        <p class="text-muted-foreground mt-4">{{ 'publicProfile.loading' | translate }}</p>
    </div>
    }

    <!-- Not Found -->
    @if (!loading() && !profile()) {
    <div class="text-center py-16 space-y-4">
        <p class="text-5xl">üêæ</p>
        <h2 class="text-2xl font-bold">{{ 'publicProfile.notFound' | translate }}</h2>
        <p class="text-muted-foreground">{{ 'publicProfile.notFoundDesc' | translate }}</p>
        <a routerLink="/" class="text-primary hover:underline">{{ 'publicProfile.backHome' | translate }}</a>
    </div>
    }

    <!-- Profile Card -->
    @if (!loading() && profile()) {
    <div class="space-y-6">
        <!-- Header -->
        <div class="bg-card rounded-xl border p-6">
            <div class="flex items-center gap-6">
                <div
                    class="w-24 h-24 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-3xl font-bold text-white overflow-hidden flex-shrink-0">
                    @if (profile()?.avatar_url) {
                    <img [src]="profile()?.avatar_url" class="w-full h-full object-cover" alt="Avatar">
                    } @else {
                    <span>{{ (profile()?.username?.charAt(0) || '?') | uppercase
                        }}</span>
                    }
                </div>
                <div class="space-y-1">
                    <h1 class="text-2xl font-bold">{{ profile()?.display_name || profile()?.username }}</h1>
                    <p class="text-sm text-muted-foreground">{{'@'}}{{ profile()?.username }}</p>
                    @if (shouldShow('pronouns') && profile()?.pronouns) {
                    <p class="text-sm text-muted-foreground">
                        {{ profile()?.pronouns }}
                    </p>
                    }
                </div>
            </div>
        </div>

        <!-- Theriotype -->
        @if (shouldShow('theriotype') && profile()?.theriotype) {
        <div class="bg-card rounded-xl border p-5 space-y-2">
            <h3 class="text-sm font-medium text-muted-foreground flex items-center gap-2">
                <span>üêæ</span> {{ 'publicProfile.theriotype' | translate }}
            </h3>
            <p class="font-medium">{{ profile()?.theriotype }}</p>
            @if (profile()?.exploration_status) {
            <div class="mt-1">
                <span class="px-2 py-0.5 rounded-full text-xs font-medium" [ngClass]="{
                            'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-300': profile()?.exploration_status === 'defined',
                            'bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-300': profile()?.exploration_status === 'exploring',
                            'bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400': profile()?.exploration_status === 'prefer_not_say'
                          }">
                    {{ profile()?.exploration_status === 'defined' ? i18n.t('publicProfile.definedLabel') :
                    profile()?.exploration_status === 'exploring' ? i18n.t('publicProfile.exploringLabel') : '‚Äî' }}
                </span>
            </div>
            }
        </div>
        }

        <!-- Bio -->
        @if (shouldShow('bio') && profile()?.bio) {
        <div class="bg-card rounded-xl border p-5 space-y-2">
            <h3 class="text-sm font-medium text-muted-foreground">{{ 'publicProfile.bioLabel' | translate }}</h3>
            <p class="text-sm leading-relaxed whitespace-pre-line">{{ profile()?.bio }}</p>
        </div>
        }

        <!-- Interests -->
        @if (shouldShow('interests') && profile()?.interests?.length) {
        <div class="bg-card rounded-xl border p-5 space-y-3">
            <h3 class="text-sm font-medium text-muted-foreground">{{ 'publicProfile.interestsLabel' | translate }}</h3>
            <div class="flex flex-wrap gap-2">
                @for (interest of profile()?.interests; track interest) {
                <span class="px-3 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary">
                    {{ interest }}
                </span>
                }
            </div>
        </div>
        }

        <!-- External Links -->
        @if (shouldShow('external_links') && hasExternalLinks()) {
        <div class="bg-card rounded-xl border p-5 space-y-3">
            <h3 class="text-sm font-medium text-muted-foreground">{{ 'publicProfile.linksLabel' | translate }}</h3>
            <div class="space-y-2">
                @for (link of externalLinksArray(); track link.url) {
                <a [href]="link.url" target="_blank" rel="noopener noreferrer"
                    class="flex items-center gap-2 text-sm text-primary hover:underline">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                        <polyline points="15 3 21 3 21 9" />
                        <line x1="10" y1="14" x2="21" y2="3" />
                    </svg>
                    {{ link.label }}
                </a>
                }
            </div>
        </div>
        }

        <!-- Member since -->
        <div class="text-center text-xs text-muted-foreground pt-4">
            {{ 'publicProfile.memberSince' | translate }} {{ profile()?.created_at | date:'MMMM yyyy' }}
        </div>
    </div>
    }
</div>