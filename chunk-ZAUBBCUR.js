import{a as H}from"./chunk-KDZ2QLQ7.js";import{a as z}from"./chunk-XNGQBVSH.js";import{a as O}from"./chunk-A7VTSCNG.js";import{a as N}from"./chunk-P6I3TYY4.js";import{c as F,e as j}from"./chunk-AMCF2LO2.js";import{$a as M,C as g,Ca as s,D as y,Da as _,E as k,Ea as x,Fa as f,Ga as E,K as C,Oa as o,Pa as d,Qa as R,S as n,W as D,Xa as P,Ya as U,Za as $,ba as m,bb as V,ca as u,fa as w,ga as S,ha as B,ia as r,ja as a,m as c,oa as T,qa as v,sa as b,y as A}from"./chunk-NQGW4V7S.js";var I=class i{http=g(V);API=O.mmoUrl;async getReports(t="pending"){try{let e=new M().set("status",t);return{data:await c(this.http.get(`${this.API}/reports`,{params:e})),error:null}}catch(e){return{data:null,error:e}}}async createReport(t){try{return await c(this.http.post(`${this.API}/reports`,t)),{error:null}}catch(e){return{error:e}}}async updateReportStatus(t,e,p){try{return await c(this.http.patch(`${this.API}/reports/${t}`,{status:e,notes:p})),{error:null}}catch(l){return{error:l}}}async getBlockedUsers(){try{return{data:await c(this.http.get(`${this.API}/blocked-users`)),error:null}}catch(t){return{data:null,error:t}}}async blockUser(t,e){try{return await c(this.http.post(`${this.API}/blocked-users`,{userId:t,reason:e})),{error:null}}catch(p){return{error:p}}}async unblockUser(t){try{return await c(this.http.delete(`${this.API}/blocked-users/${t}`)),{error:null}}catch(e){return{error:e}}}static \u0275fac=function(e){return new(e||i)};static \u0275prov=A({token:i,factory:i.\u0275fac,providedIn:"root"})};var G=(i,t)=>t.id;function K(i,t){i&1&&(r(0,"div",5),s(1),o(2,"translate"),a()),i&2&&(n(),_(d(2,1,"admin.loadingReports")))}function L(i,t){i&1&&(r(0,"div",6),s(1),o(2,"translate"),a()),i&2&&(n(),x(" ",d(2,1,"admin.noReports")," "))}function Q(i,t){if(i&1){let e=T();r(0,"app-card",7)(1,"div",8)(2,"div")(3,"span",9),s(4),o(5,"uppercase"),a(),r(6,"p",10),s(7),o(8,"translate"),a(),r(9,"p",11),s(10),o(11,"translate"),a(),r(12,"p",12),s(13),o(14,"translate"),o(15,"date"),a()(),r(16,"div",13)(17,"app-button",14),v("click",function(){let l=y(e).$implicit,h=b(2);return k(h.resolveReport(l.id,"dismissed"))}),s(18),o(19,"translate"),a(),r(20,"app-button",15),v("click",function(){let l=y(e).$implicit,h=b(2);return k(h.resolveReport(l.id,"actioned"))}),s(21),o(22,"translate"),a()()()()}if(i&2){let e=t.$implicit;n(4),x(" ",d(5,9,e.content_type)," "),n(3),f("",d(8,11,"admin.reason"),": ",e.reason),n(3),f("",d(11,13,"admin.contentId"),": ",e.content_id),n(3),f("",d(14,15,"admin.reportedOn"),": ",R(15,17,e.created_at,"medium")),n(5),_(d(19,20,"admin.dismiss")),n(3),_(d(22,22,"admin.takeAction"))}}function W(i,t){if(i&1&&(r(0,"div",4),m(1,K,3,3,"div",5),m(2,L,3,3,"div",6),w(3,Q,23,24,"app-card",7,G),a()),i&2){let e=b();n(),u(e.loading()?1:-1),n(),u(!e.loading()&&e.reports().length===0?2:-1),n(),S(e.reports())}}function X(i,t){i&1&&(r(0,"div",5),s(1),o(2,"translate"),a()),i&2&&(n(),_(d(2,1,"admin.loadingUsers")))}function Y(i,t){i&1&&(r(0,"div",6),s(1),o(2,"translate"),a()),i&2&&(n(),x(" ",d(2,1,"admin.noBlocked")," "))}function Z(i,t){if(i&1){let e=T();r(0,"app-card",7)(1,"div",16)(2,"div")(3,"h3",17),s(4),o(5,"translate"),a(),r(6,"p",18),s(7),o(8,"translate"),a(),r(9,"p",19),s(10),o(11,"translate"),o(12,"date"),a()(),r(13,"app-button",14),v("click",function(){let l=y(e).$implicit,h=b(2);return k(h.unblockUser(l.id))}),s(14),o(15,"translate"),a()()()}if(i&2){let e=t.$implicit;n(4),f("",d(5,8,"admin.userId"),": ",e.blocked_user_id),n(3),f("",d(8,10,"admin.reason"),": ",e.reason),n(3),E("",d(11,12,"admin.blockedBy"),": ",e.blocked_by," ",d(12,14,e.created_at)),n(4),_(d(15,16,"admin.unblock"))}}function ee(i,t){if(i&1&&(r(0,"div",4),m(1,X,3,3,"div",5),m(2,Y,3,3,"div",6),w(3,Z,16,18,"app-card",7,G),a()),i&2){let e=b();n(),u(e.loading()?1:-1),n(),u(!e.loading()&&e.blockedUsers().length===0?2:-1),n(),S(e.blockedUsers())}}var q=class i{moderationService=g(I);authService=g(z);activeTab=C("reports");reports=C([]);blockedUsers=C([]);loading=C(!1);ngOnInit(){this.loadReports()}async loadReports(){this.loading.set(!0);let{data:t}=await this.moderationService.getReports("pending");t&&this.reports.set(t),this.loading.set(!1)}async loadBlockedUsers(){this.loading.set(!0);let{data:t}=await this.moderationService.getBlockedUsers();t&&this.blockedUsers.set(t),this.loading.set(!1)}async setTab(t){this.activeTab.set(t),t==="reports"?await this.loadReports():await this.loadBlockedUsers()}async resolveReport(t,e){await this.moderationService.updateReportStatus(t,e),await this.loadReports()}async unblockUser(t){await this.moderationService.unblockUser(t),await this.loadBlockedUsers()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=D({type:i,selectors:[["app-admin-dashboard"]],decls:13,vars:13,consts:[[1,"container","mx-auto","py-8","px-4"],[1,"text-3xl","font-bold","tracking-tight","mb-6"],[1,"flex","gap-4","mb-6"],[3,"click","variant"],[1,"space-y-4"],[1,"text-center","py-8"],[1,"text-center","py-8","text-muted-foreground","bg-muted","rounded-lg"],[1,"mb-4"],[1,"flex","justify-between","items-start"],[1,"inline-block","px-2","py-1","text-xs","font-semibold","rounded-full","bg-yellow-100","text-yellow-800","mb-2"],[1,"font-medium"],[1,"text-sm","text-muted-foreground"],[1,"text-xs","text-muted-foreground","mt-1"],[1,"flex","flex-col","gap-2"],["size","sm","variant","outline",3,"click"],["size","sm","variant","danger",3,"click"],[1,"flex","justify-between","items-center"],[1,"font-bold"],[1,"text-sm"],[1,"text-xs","text-muted-foreground"]],template:function(e,p){e&1&&(r(0,"div",0)(1,"h1",1),s(2),o(3,"translate"),a(),r(4,"div",2)(5,"app-button",3),v("click",function(){return p.setTab("reports")}),s(6),o(7,"translate"),a(),r(8,"app-button",3),v("click",function(){return p.setTab("users")}),s(9),o(10,"translate"),a()(),m(11,W,5,2,"div",4),m(12,ee,5,2,"div",4),a()),e&2&&(n(2),_(d(3,7,"admin.title")),n(3),B("variant",p.activeTab()==="reports"?"primary":"outline"),n(),x(" ",d(7,9,"admin.pendingReports")," "),n(2),B("variant",p.activeTab()==="users"?"primary":"outline"),n(),x(" ",d(10,11,"admin.blockedUsers")," "),n(2),u(p.activeTab()==="reports"?11:-1),n(),u(p.activeTab()==="users"?12:-1))},dependencies:[$,N,H,j,P,U,F],encapsulation:2})};export{q as AdminDashboardComponent};
