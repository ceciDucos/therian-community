import{a as ee}from"./chunk-BPALIKTN.js";import{a as Z}from"./chunk-HWHG6NHR.js";import{a as U}from"./chunk-KCUVPFKU.js";import{a as z}from"./chunk-GS3VH2CW.js";import"./chunk-A7VTSCNG.js";import{a as j}from"./chunk-UOP3CD4R.js";import{b as $,d as H,e as R,g as q,h as L,i as W,j as J,k as K,l as Q,m as X,o as Y}from"./chunk-ZFKS3NJ4.js";import{b as D,c as G,e as A}from"./chunk-6I7YCHVY.js";import{C as y,D as P,E as w,Ea as m,F as C,Fa as _,G as k,Ga as h,K as x,Oa as N,Qa as a,R as M,Ra as l,S as n,W as E,Za as B,_a as V,a as b,ab as I,ba as u,ca as g,fa as T,ga as F,ha as f,ia as o,ja as r,ka as c,oa as S,qa as O,sa as v}from"./chunk-RTC3656N.js";var ie=(t,i)=>({"profile__avatar-selection-button--selected":t,"profile__avatar-selection-button--unselected":i}),ne=(t,i)=>i.url;function oe(t,i){t&1&&(o(0,"div",2),m(1),a(2,"translate"),r()),t&2&&(n(),h(" ",l(2,1,"profile.loading")," "))}function re(t,i){if(t&1&&c(0,"img",8),t&2){let e,p=v(2);f("src",(e=p.profileForm.get("avatar_url"))==null?null:e.value,M)}}function ae(t,i){if(t&1&&(o(0,"span"),m(1),a(2,"uppercase"),r()),t&2){let e,p=v(2);n(),_(l(2,1,((e=p.profile())==null||e.username==null?null:e.username.charAt(0))||"?"))}}function le(t,i){t&1&&(o(0,"div",35)(1,"div"),C(),o(2,"svg",36),c(3,"polyline",37),r()()())}function pe(t,i){if(t&1){let e=S();o(0,"button",33),O("click",function(){let s=P(e).$implicit,d=v(2);return w(d.selectAvatar(s.url))}),c(1,"img",34),u(2,le,4,0,"div",35),r()}if(t&2){let e,p,s=i.$implicit,d=v(2);f("ngClass",N(4,ie,((e=d.profileForm.get("avatar_url"))==null?null:e.value)===s.url,((e=d.profileForm.get("avatar_url"))==null?null:e.value)!==s.url)),n(),f("src",s.url,M)("alt",s.name),n(),g(((p=d.profileForm.get("avatar_url"))==null?null:p.value)===s.url?2:-1)}}function se(t,i){t&1&&(C(),o(0,"svg",27),c(1,"path",38)(2,"polyline",39),r())}function de(t,i){t&1&&(C(),o(0,"svg",27),c(1,"circle",40)(2,"line",41)(3,"line",42),r())}function ce(t,i){if(t&1&&(o(0,"div",29),u(1,se,3,0,":svg:svg",27),u(2,de,4,0,":svg:svg",27),m(3),r()),t&2){let e=v(2);f("ngClass",e.messageType()==="success"?"profile__message--success":"profile__message--error"),n(),g(e.messageType()==="success"?1:-1),n(),g(e.messageType()==="error"?2:-1),n(),h(" ",e.message()," ")}}function me(t,i){t&1&&(o(0,"span",32),C(),o(1,"svg",43),c(2,"circle",44)(3,"path",45),r(),m(4),a(5,"translate"),r()),t&2&&(n(4),h(" ",l(5,1,"profile.saving")," "))}function fe(t,i){t&1&&(o(0,"span"),m(1),a(2,"translate"),r()),t&2&&(n(),_(l(2,1,"profile.saveChanges")))}function _e(t,i){if(t&1){let e=S();o(0,"form",4),O("ngSubmit",function(){P(e);let s=v();return w(s.onSubmit())}),o(1,"div",5)(2,"div",6)(3,"div",7),u(4,re,1,1,"img",8)(5,ae,3,3,"span"),r()(),o(6,"div",9)(7,"h3"),m(8),r(),o(9,"p"),m(10),r()()(),c(11,"hr",10),o(12,"div",11)(13,"label"),m(14,"Choose an Avatar"),r(),o(15,"div",12),T(16,pe,3,7,"button",13,ne),r()(),c(18,"hr",10),o(19,"div",14),c(20,"app-input",15),a(21,"translate"),a(22,"translate"),o(23,"div",16),c(24,"app-input",17),a(25,"translate"),a(26,"translate"),c(27,"app-input",18),a(28,"translate"),a(29,"translate"),r(),o(30,"div",19)(31,"label"),m(32),a(33,"translate"),r(),c(34,"textarea",20),a(35,"translate"),r(),o(36,"div",19)(37,"label"),m(38),a(39,"translate"),r(),o(40,"div",21)(41,"select",22)(42,"option",23),m(43),a(44,"translate"),r(),o(45,"option",24),m(46),a(47,"translate"),r(),o(48,"option",25),m(49),a(50,"translate"),r()(),o(51,"div",26),C(),o(52,"svg",27),c(53,"path",28),r()()()()(),u(54,ce,4,4,"div",29),k(),o(55,"div",30)(56,"app-button",31),u(57,me,6,3,"span",32)(58,fe,3,3,"span"),r()()()}if(t&2){let e,p,s,d=v();f("formGroup",d.profileForm),n(4),g((e=d.profileForm.get("avatar_url"))!=null&&e.value?4:5),n(4),_((p=d.profile())==null?null:p.username),n(2),_((s=d.authService.user())==null?null:s.email),n(6),F(d.masks),n(4),f("label",l(21,19,"profile.displayName"))("placeholder",l(22,21,"profile.displayNamePlaceholder")),n(4),f("label",l(25,23,"profile.theriotype"))("placeholder",l(26,25,"profile.theriotypePlaceholder")),n(3),f("label",l(28,27,"profile.pronouns"))("placeholder",l(29,29,"profile.pronounsPlaceholder")),n(5),_(l(33,31,"profile.bio")),n(2),f("placeholder",l(35,33,"profile.bioPlaceholder")),n(4),_(l(39,35,"profile.explorationStatus")),n(5),_(l(44,37,"profile.exploring")),n(3),_(l(47,39,"profile.defined")),n(3),_(l(50,41,"profile.preferNotSay")),n(5),g(d.message()?54:-1),n(2),f("disabled",d.saving()),n(),g(d.saving()?57:58)}}var te=class t{authService=y(z);profileService=y(ee);translate=y(D);fb=y(X);profile=x(null);loading=x(!0);saving=x(!1);message=x("");messageType=x("success");profileForm=this.fb.group({display_name:[""],theriotype:[""],pronouns:[""],bio:[""],exploration_status:["exploring"],avatar_url:[""]});masks=[{id:"wolf",url:"assets/masks/wolf.png",name:"Wolf"},{id:"cat",url:"assets/masks/cat.png",name:"Cat"},{id:"deer",url:"assets/masks/deer.png",name:"Deer"},{id:"raven",url:"assets/masks/raven.png",name:"Raven"},{id:"dragon",url:"assets/masks/dragon.png",name:"Dragon"}];async ngOnInit(){let i=await this.authService.getCurrentUser();i?await this.loadProfile(i.id):this.loading.set(!1)}async loadProfile(i){this.loading.set(!0);let{data:e,error:p}=await this.profileService.getProfile(i);e&&(this.profile.set(e),this.profileForm.patchValue({display_name:e.display_name,theriotype:e.theriotype,pronouns:e.pronouns,bio:e.bio,exploration_status:e.exploration_status||"exploring",avatar_url:e.avatar_url})),this.loading.set(!1)}selectAvatar(i){this.profileForm.patchValue({avatar_url:i}),this.profileForm.markAsDirty()}async onSubmit(){if(this.profileForm.invalid)return;this.saving.set(!0),this.message.set("");let i=this.authService.user();if(!i)return;let e={display_name:this.profileForm.value.display_name,bio:this.profileForm.value.bio,avatar_url:this.profileForm.value.avatar_url,updated_at:new Date};if(!this.profile()){let s=i.email||"";e.username=s.split("@")[0]||`user_${i.id.slice(0,8)}`}let{error:p}=await this.profileService.updateProfile(i.id,e);p?(this.message.set(this.translate.instant("profile.updateError")),this.messageType.set("error")):(this.message.set(this.translate.instant("profile.updateSuccess")),this.messageType.set("success"),this.profile.update(s=>b(b({},s),e))),this.saving.set(!1)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=E({type:t,selectors:[["app-profile"]],decls:5,vars:6,consts:[[1,"profile"],[3,"header","title"],[1,"profile__loading"],[1,"profile__form",3,"formGroup"],[1,"profile__form",3,"ngSubmit","formGroup"],[1,"profile__header"],[1,"profile__header-avatar-wrapper","group"],[1,"profile__header-avatar"],[3,"src"],[1,"profile__header-info"],[1,"profile__divider"],[1,"profile__avatar-selection"],[1,"profile__avatar-selection-grid"],["type","button",1,"profile__avatar-selection-button",3,"ngClass"],[1,"profile__fields"],["formControlName","display_name",3,"label","placeholder"],[1,"profile__fields-row"],["formControlName","theriotype",3,"label","placeholder"],["formControlName","pronouns",3,"label","placeholder"],[1,"profile__field"],["formControlName","bio",3,"placeholder"],[1,"profile__select-wrapper"],["formControlName","exploration_status"],["value","exploring"],["value","defined"],["value","prefer_not_say"],[1,"profile__select-wrapper-icon"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],["d","m6 9 6 6 6-6"],[1,"profile__message","animate-in","fade-in","slide-in-from-top-2",3,"ngClass"],[1,"profile__actions"],["type","submit","variant","primary","size","lg",3,"disabled"],[1,"profile__saving"],["type","button",1,"profile__avatar-selection-button",3,"click","ngClass"],[3,"src","alt"],[1,"profile__avatar-selection-button-overlay"],["xmlns","http://www.w3.org/2000/svg","width","14","height","14","viewBox","0 0 24 24","fill","none","stroke","currentColor","stroke-width","4","stroke-linecap","round","stroke-linejoin","round"],["points","20 6 9 17 4 12"],["d","M22 11.08V12a10 10 0 1 1-5.93-9.14"],["points","22 4 12 14.01 9 11.01"],["cx","12","cy","12","r","10"],["x1","15","y1","9","x2","9","y2","15"],["x1","9","y1","9","x2","15","y2","15"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"]],template:function(e,p){e&1&&(o(0,"div",0)(1,"app-card",1),a(2,"translate"),u(3,oe,3,3,"div",2),u(4,_e,59,43,"form",3),r()()),e&2&&(n(),f("header",!0)("title",l(2,4,"profile.title")),n(2),g(p.loading()?3:-1),n(),g(p.loading()?-1:4))},dependencies:[I,B,Y,q,K,Q,$,J,H,R,W,L,j,Z,U,A,V,G],styles:[".profile[_ngcontent-%COMP%]{@apply container mx-auto py-12 px-4 max-w-xl;}.profile__loading[_ngcontent-%COMP%]{@apply py-12 text-center animate-pulse;color:hsl(var(--muted-foreground))}.profile__form[_ngcontent-%COMP%]{@apply space-y-8;}.profile__header[_ngcontent-%COMP%]{@apply flex flex-col items-center space-y-4;@apply relative;}.profile__header-avatar[_ngcontent-%COMP%]{@apply w-32 h-32 rounded-full bg-secondary/50 flex items-center justify-center text-4xl font-bold text-secondary-foreground overflow-hidden border-4 border-primary/20 shadow-lg;}.profile__header-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{@apply w-full h-full object-cover;}.profile__header-info[_ngcontent-%COMP%]{@apply text-center space-y-1;}.profile__header-info[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{@apply font-bold text-2xl text-foreground;}.profile__header-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{@apply text-sm;color:hsl(var(--muted-foreground))}.profile__divider[_ngcontent-%COMP%]{@apply border-border/50;}.profile__avatar-selection[_ngcontent-%COMP%]{@apply space-y-4;}.profile__avatar-selection[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{@apply text-sm font-semibold text-foreground/80 block;}.profile__avatar-selection-grid[_ngcontent-%COMP%]{@apply grid grid-cols-5 gap-4;}.profile__avatar-selection-button[_ngcontent-%COMP%]{@apply relative aspect-square rounded-2xl overflow-hidden border-2 transition-all duration-200 hover:scale-110 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 bg-muted/20 cursor-pointer;}.profile__avatar-selection-button--selected[_ngcontent-%COMP%]{@apply border-primary opacity-100;}.profile__avatar-selection-button--unselected[_ngcontent-%COMP%]{@apply border-transparent opacity-50;}.profile__avatar-selection-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{@apply w-full h-full object-cover;}.profile__avatar-selection-button-overlay[_ngcontent-%COMP%]{@apply absolute inset-0 bg-primary/20 flex items-center justify-center backdrop-blur-[1px];}.profile__avatar-selection-button-overlay[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{@apply bg-primary text-primary-foreground rounded-full p-1.5 shadow-sm;}.profile__fields[_ngcontent-%COMP%]{@apply grid gap-6;}.profile__fields-row[_ngcontent-%COMP%]{@apply grid grid-cols-2 gap-6;}.profile__field[_ngcontent-%COMP%]{@apply space-y-2;}.profile__field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{@apply text-sm font-medium leading-none text-foreground/80;}.profile__field[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{@apply flex min-h-[120px] w-full rounded-xl border border-input bg-background px-4 py-3 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all resize-none shadow-sm;}.profile__select-wrapper[_ngcontent-%COMP%]{@apply relative;}.profile__select-wrapper[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{@apply flex h-12 w-full rounded-xl border border-input bg-background px-4 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all appearance-none shadow-sm cursor-pointer hover:bg-muted/5;}.profile__select-wrapper-icon[_ngcontent-%COMP%]{@apply absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none;color:hsl(var(--muted-foreground))}.profile__message[_ngcontent-%COMP%]{@apply p-4 text-sm rounded-xl flex items-center gap-2;}.profile__message--success[_ngcontent-%COMP%]{@apply bg-green-500/10 text-green-600 border border-green-500/20;}.profile__message--error[_ngcontent-%COMP%]{@apply bg-red-500/10 text-red-600 border border-red-500/20;}.profile__actions[_ngcontent-%COMP%]{@apply flex justify-end pt-4;}.profile__actions[_ngcontent-%COMP%]   app-button[_ngcontent-%COMP%]{@apply w-full sm:w-auto min-w-[150px] shadow-md hover:shadow-lg transition-all;}.profile__saving[_ngcontent-%COMP%]{@apply flex items-center gap-2;}.profile__saving[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{@apply animate-spin h-4 w-4;}"]})};export{te as ProfileComponent};
